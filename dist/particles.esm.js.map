{"version":3,"file":"particles.esm.js","sources":["../src/contants.ts","../src/particles.ts","../src/canvas.ts","../src/main.ts"],"sourcesContent":["const math = Math;\n\nexport const win = window;\nexport const reqAnimationFrame = window.requestAnimationFrame;\nexport const EVENT_NAME_RESIZE = \"resize\";\nexport const random = math.random;\nexport const ceil = math.ceil;\nexport const floor = math.floor;\n","import { ceil, random } from \"./contants\";\n\nexport type Particle = {\n  x: number;\n  y: number;\n  r: number;\n  vx: number;\n  vy: number;\n};\n\ntype Boundry = {\n  x1: number;\n  x2: number;\n  y1: number;\n  y2: number;\n};\n\nconst randomVelocity = (speed: number): number => {\n  const r = ceil(random() * speed);\n  return (random() > 0.5 ? 1 : -1) * (r === 0 ? randomVelocity(speed) : r);\n};\n\nfunction createParticle({ x1, y1, x2, y2 }: Boundry, speed: number): Particle {\n  const vx = randomVelocity(speed);\n  const vy = randomVelocity(speed);\n  const x = x1 + ceil(random() * x2);\n  const y = y1 + ceil(random() * y2);\n  const r = Math.sqrt(x * x + y * y) | 0;\n\n  return { x, y, r, vx, vy };\n}\n\nfunction createParticles(\n  { x1, y1, x2, y2 }: Boundry,\n  count = 200,\n  speed = 4\n): Particle[] {\n  const array = new Array(count);\n  for (let i = 0; i < count; i++) {\n    array[i] = createParticle({ x1, y1, x2, y2 }, speed);\n  }\n  return array;\n}\n\nfunction moveParticles(particles: Particle[], width: number, height: number) {\n  const threshold = 100;\n  const x1 = 0 - threshold;\n  const y1 = 0 - threshold;\n  const x2 = width + threshold;\n  const y2 = height + threshold;\n  const count = particles.length;\n\n  for (let i = 0; i < count; i++) {\n    let particle = particles[i];\n\n    const pX = particle.x + particle.vx;\n    const pY = particle.y + particle.vy;\n    particle.x = pX;\n    particle.y = pY;\n    particle.r = Math.sqrt(pX * pX + pY * pY);\n\n    if (pX < x1 || pX > x2) {\n      particle.vx = -particle.vx;\n    }\n\n    if (pY < y1 || pY > y2) {\n      particle.vy = -particle.vy;\n    }\n  }\n}\n\nexport { createParticles, moveParticles };\n","import { floor } from \"./contants\";\nimport type { Particle } from \"./particles\";\n\nexport function resizer(canvas: HTMLCanvasElement) {\n  return () => {\n    const width = canvas.offsetWidth;\n    const height = canvas.offsetHeight;\n    canvas.width = width;\n    canvas.height = height;\n    return { width, height };\n  };\n}\n\nfunction createMatrix(particles: Particle[], distance: number) {\n  const matrix: Particle[][][] = new Array();\n\n  particles.forEach((particle) => {\n    const row = floor(particle.y / distance);\n    const col = floor(particle.x / distance);\n\n    if (matrix[row] == null) {\n      matrix[row] = [];\n    }\n    if (matrix[row][col] == null) {\n      matrix[row][col] = [] as Particle[];\n    }\n    matrix[row][col].push(particle);\n  });\n\n  return matrix;\n}\n\nconst ensureArray = (subject?: any) =>\n  subject == null ? [] : Array.isArray(subject) ? subject : [subject];\n\nconst getBlock = (\n  matrix: Particle[][][],\n  row: number,\n  column: number\n): Particle[] => ensureArray(ensureArray(matrix[row])[column]);\n\nexport function draw(\n  canvas: HTMLCanvasElement,\n  particles: Particle[],\n  { distance, strokeStyle, fillStyle, size = 2 }\n) {\n  const { width, height } = canvas;\n  const context = canvas.getContext(\"2d\");\n  context.fillStyle = fillStyle || \"black\";\n  context.strokeStyle = strokeStyle || \"rgba(0,0,0,0.1)\";\n  context.clearRect(0, 0, width, height);\n  context.beginPath();\n\n  const columns = Math.ceil(width / distance);\n  const rows = Math.ceil(height / distance);\n  const matrix = createMatrix(particles, distance);\n\n  const distanceSquare = distance * distance;\n  const halfSize = size / 2;\n\n  for (let row = 0; row < rows; row++) {\n    for (let column = 0; column < columns; column++) {\n      const block: Particle[] = getBlock(matrix, row, column);\n      const neighbours = [].concat(\n        block,\n        getBlock(matrix, row + 1, column),\n        getBlock(matrix, row, column + 1),\n        getBlock(matrix, row + 1, column + 1)\n      );\n\n      block.forEach((particle) => {\n        neighbours.forEach((neighbour) => {\n          if (particle !== neighbour) {\n            const dx = particle.x - neighbour.x;\n            const dy = particle.y - neighbour.y;\n\n            if (dx * dx + dy * dy < distanceSquare) {\n              context.moveTo(particle.x, particle.y);\n              context.lineTo(neighbour.x, neighbour.y);\n            }\n          }\n        });\n\n        context.fillRect(\n          particle.x - halfSize,\n          particle.y - halfSize,\n          size,\n          size\n        );\n      });\n    }\n  }\n\n\n\n  context.stroke();\n}\n","import { createParticles, moveParticles } from \"./particles\";\nimport { draw, resizer } from \"./canvas\";\nimport { win, reqAnimationFrame, EVENT_NAME_RESIZE } from \"./contants\";\n\ntype Config = {\n  count: number;\n  distance: number;\n  speed: number;\n  animate;\n  boolean;\n  strokeStyle: string;\n  fillStyle: string;\n  size: number;\n};\n\nexport function init(canvas: HTMLCanvasElement, config: Config) {\n  var {\n    count,\n    distance,\n    speed,\n    animate = true,\n    strokeStyle,\n    fillStyle,\n    size = 2,\n  } = config;\n  const onResize = resizer(canvas);\n  const { width, height } = onResize();\n  const particles = createParticles(\n    {\n      x1: 0,\n      y1: 0,\n      x2: width,\n      y2: height,\n    },\n    count,\n    speed\n  );\n\n  win.addEventListener(EVENT_NAME_RESIZE, onResize);\n\n  function redraw() {\n    particles.sort(function (a, b) {\n      return a.r - b.r;\n    });\n\n    //console.time(\"draw\")\n    draw(canvas, particles, { distance, strokeStyle, fillStyle, size });\n    //console.timeEnd(\"draw\")\n\n    if (animate !== false) {\n      moveParticles(particles, width, height);\n      reqAnimationFrame(redraw);\n    }\n  }\n  reqAnimationFrame(redraw);\n\n  return () => {\n    animate = false;\n    win.removeEventListener(EVENT_NAME_RESIZE, onResize);\n  };\n}\n"],"names":["math","Math","win","window","reqAnimationFrame","requestAnimationFrame","EVENT_NAME_RESIZE","random","ceil","floor","randomVelocity","speed","r","createParticle","x1","y1","x2","y2","vx","vy","x","y","sqrt","createParticles","count","array","Array","i","moveParticles","particles","width","height","length","particle","pX","pY","resizer","canvas","offsetWidth","offsetHeight","createMatrix","distance","matrix","forEach","row","col","push","ensureArray","subject","isArray","getBlock","column","draw","strokeStyle","fillStyle","size","context","getContext","clearRect","beginPath","columns","rows","distanceSquare","halfSize","block","neighbours","concat","neighbour","dx","dy","moveTo","lineTo","fillRect","stroke","init","config","animate","onResize","redraw","sort","a","b","addEventListener","removeEventListener"],"mappings":"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"}