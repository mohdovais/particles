{"version":3,"file":"particles.esm.js","sources":["../src/contants.ts","../src/particles.ts","../src/canvas.ts","../src/main.ts"],"sourcesContent":["const math = Math;\n\nexport const win = window;\nexport const reqAnimationFrame = window.requestAnimationFrame;\nexport const EVENT_NAME_RESIZE = \"resize\";\nexport const random = math.random;\nexport const ceil = math.ceil;\nexport const floor = math.floor;\n","import { ceil, random } from \"./contants\";\n\nexport type Particle = {\n  x: number;\n  y: number;\n  r: number;\n  vx: number;\n  vy: number;\n};\n\ntype Boundry = {\n  x1: number;\n  x2: number;\n  y1: number;\n  y2: number;\n};\n\nconst randomVelocity = (speed: number): number => {\n  const r = ceil(random() * speed);\n  return (random() > 0.5 ? 1 : -1) * (r === 0 ? randomVelocity(speed) : r);\n};\n\nfunction createParticle({ x1, y1, x2, y2 }: Boundry, speed: number): Particle {\n  const vx = randomVelocity(speed);\n  const vy = randomVelocity(speed);\n  const x = x1 + ceil(random() * x2);\n  const y = y1 + ceil(random() * y2);\n  const r = Math.sqrt(x * x + y * y) | 0;\n\n  return { x, y, r, vx, vy };\n}\n\nfunction createParticles(\n  { x1, y1, x2, y2 }: Boundry,\n  count = 200,\n  speed = 4\n): Particle[] {\n  const array = new Array(count);\n  for (let i = 0; i < count; i++) {\n    array[i] = createParticle({ x1, y1, x2, y2 }, speed);\n  }\n  return array;\n}\n\nfunction moveParticles(particles: Particle[], width: number, height: number) {\n  const threshold = 0;\n  const x1 = 0 - threshold;\n  const y1 = 0 - threshold;\n  const x2 = width + threshold;\n  const y2 = height + threshold;\n  const count = particles.length;\n\n  for (let i = 0; i < count; i++) {\n    let particle = particles[i];\n\n    const pX = particle.x + particle.vx;\n    const pY = particle.y + particle.vy;\n    particle.x = pX;\n    particle.y = pY;\n    particle.r = Math.sqrt(pX * pX + pY * pY);\n\n    /*\n    if (pX < x1) {\n      particle.x = x2;\n    } else if (pX > x2) {\n      particle.x = x1;\n    }\n\n    if (pY < y1) {\n      particle.y = y2;\n    } else if (pY > y2) {\n      particle.y = y1;\n    }\n    */\n\n    if (pX < x1 || pX > x2) {\n      particle.vx = -particle.vx;\n    }\n\n    if (pY < y1 || pY > y2) {\n      particle.vy = -particle.vy;\n    }\n  }\n}\n\nexport { createParticles, moveParticles };\n","import { floor } from \"./contants\";\nimport type { Particle } from \"./particles\";\n\nfunction resizer(canvas: HTMLCanvasElement) {\n  return () => {\n    const width = canvas.offsetWidth;\n    const height = canvas.offsetHeight;\n    canvas.width = width;\n    canvas.height = height;\n    return { width, height };\n  };\n}\n\nconst ensureArray = (subject?: any) =>\n  subject == null ? [] : Array.isArray(subject) ? subject : [subject];\n\n// devide & rule\nfunction createMatrix(particles: Particle[], distance: number) {\n  const matrix: Particle[][][] = new Array();\n\n  particles.forEach((particle) => {\n    const row = floor(particle.y / distance);\n    const col = floor(particle.x / distance);\n\n    if (matrix[row] == null) {\n      matrix[row] = [];\n    }\n    if (matrix[row][col] == null) {\n      matrix[row][col] = [] as Particle[];\n    }\n    matrix[row][col].push(particle);\n  });\n\n  return matrix;\n}\n\nconst getBlock = (\n  matrix: Particle[][][],\n  row: number,\n  column: number\n): Particle[] => ensureArray(ensureArray(matrix[row])[column]);\n\nfunction draw(\n  canvas: HTMLCanvasElement,\n  particles: Particle[],\n  { distance, strokeStyle, fillStyle, size }\n) {\n  const { width, height } = canvas;\n  const context = canvas.getContext(\"2d\");\n  const columns = Math.ceil(width / distance);\n  const rows = Math.ceil(height / distance);\n  const matrix = createMatrix(particles, distance);\n  const distanceSquare = distance * distance;\n  const halfSize = size / 2;\n\n  const drawLine = (a: Particle, b: Particle) => {\n    const dx = a.x - b.x;\n    const dy = a.y - b.y;\n\n    if (dx * dx + dy * dy < distanceSquare) {\n      context.moveTo(a.x, a.y);\n      context.lineTo(b.x, b.y);\n    }\n  };\n\n  context.beginPath();\n  context.clearRect(0, 0, width, height);\n  context.fillStyle = fillStyle;\n  context.strokeStyle = strokeStyle;\n\n  // run loop for Row-x-Column matrix\n  for (let row = 0; row < rows; row++) {\n    for (let column = 0; column < columns; column++) {\n      const block: Particle[] = getBlock(matrix, row, column);\n      const neighbours = [].concat(\n        getBlock(matrix, row, column + 1),\n        getBlock(matrix, row + 1, column),\n        getBlock(matrix, row + 1, column + 1)\n      );\n\n      const processed = new Set();\n\n      block.forEach((particle) => {\n        processed.add(particle);\n\n        // run for neighbour points within block\n        block.forEach((neighbour) => {\n          if (!processed.has(neighbour)) {\n            drawLine(particle, neighbour);\n          }\n        });\n\n        // run for neighbour points in adjacent blocks\n        neighbours.forEach((neighbour) => {\n          drawLine(particle, neighbour);\n        });\n\n        context.fillRect(\n          particle.x - halfSize,\n          particle.y - halfSize,\n          size,\n          size\n        );\n      });\n    }\n  }\n\n  context.stroke();\n  context.restore();\n}\n\nexport { resizer, draw };\n","import { createParticles, moveParticles } from \"./particles\";\nimport { draw, resizer } from \"./canvas\";\nimport { win, reqAnimationFrame, EVENT_NAME_RESIZE } from \"./contants\";\n\ntype Config = {\n  count: number;\n  distance: number;\n  speed: number;\n  animate: boolean;\n  strokeStyle: string;\n  fillStyle: string;\n  size: number;\n};\n\nexport function init(canvas: HTMLCanvasElement, config: Config) {\n  var {\n    count = 500,\n    distance = 100,\n    speed = 4,\n    animate = true,\n    strokeStyle = \"rgba(0,0,0,0.1)\",\n    fillStyle = \"black\",\n    size = 2,\n  } = config;\n  const onResize = resizer(canvas);\n  const { width, height } = onResize();\n  const particles = createParticles(\n    {\n      x1: 0,\n      y1: 0,\n      x2: width,\n      y2: height,\n    },\n    count,\n    speed\n  );\n\n  win.addEventListener(EVENT_NAME_RESIZE, onResize);\n\n  let oldTimestamp = 0;\n\n  function redraw(timestamp = 0) {\n    if (timestamp - oldTimestamp > 16) {\n      draw(canvas, particles, { distance, strokeStyle, fillStyle, size });\n      moveParticles(particles, width, height);\n      oldTimestamp = timestamp;\n    }\n\n    if (animate !== false) {\n      reqAnimationFrame(redraw);\n    }\n  }\n  reqAnimationFrame(redraw);\n\n  return () => {\n    animate = false;\n    win.removeEventListener(EVENT_NAME_RESIZE, onResize);\n  };\n}\n"],"names":["math","Math","win","window","reqAnimationFrame","requestAnimationFrame","EVENT_NAME_RESIZE","random","ceil","floor","randomVelocity","speed","r","createParticle","x1","y1","x2","y2","vx","vy","x","y","sqrt","createParticles","count","array","Array","i","moveParticles","particles","width","height","length","particle","pX","pY","resizer","canvas","offsetWidth","offsetHeight","ensureArray","subject","isArray","createMatrix","distance","matrix","forEach","row","col","push","getBlock","column","draw","strokeStyle","fillStyle","size","context","getContext","columns","rows","distanceSquare","halfSize","drawLine","a","b","dx","dy","moveTo","lineTo","beginPath","clearRect","block","neighbours","concat","processed","Set","add","neighbour","has","fillRect","stroke","restore","init","config","animate","onResize","addEventListener","oldTimestamp","redraw","timestamp","removeEventListener"],"mappings":"AAAA,MAAMA,CAAI,CAAGC,IAAI,CAEJC,CAAG,CAAGC,MAAM,CACZC,CAAiB,CAAGD,MAAM,CAACE,qBAAqB,CAChDC,CAAiB,CAAG,SACpBC,CAAM,CAAGP,CAAI,CAACO,MAAM,CACpBC,CAAI,CAAGR,CAAI,CAACQ,IAAI,CAChBC,CAAK,CAAGT,CAAI,CAACS,KAAK,CCUzBC,CAAc,CAAIC,CAAa,EAAa,CAChD,MAAMC,CAAC,CAAGJ,CAAI,CAACD,CAAM,GAAKI,CAAK,EAC/B,OAAQJ,CAAM,GAAK,GAAG,CAAG,CAAC,GAAK,GAAW,CAAC,GAAPK,CAAC,CAASF,CAAc,CAACC,CAAK,EAAIC,CAAC,CACzE,CAAC,UAEQC,CAAc,CAAC,CAAEC,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAW,CAAEN,CAAa,CAAY,CAC5E,MAAMO,CAAE,CAAGR,CAAc,CAACC,CAAK,EACzBQ,CAAE,CAAGT,CAAc,CAACC,CAAK,EACzBS,CAAC,CAAGN,CAAE,CAAGN,CAAI,CAACD,CAAM,GAAKS,CAAE,EAC3BK,CAAC,CAAGN,CAAE,CAAGP,CAAI,CAACD,CAAM,GAAKU,CAAE,EAGjC,MAAO,CAAEG,CAAC,CAADA,CAAC,CAAEC,CAAC,CAADA,CAAC,CAAET,CAAC,CAFqB,CAAC,CAA5BX,IAAI,CAACqB,IAAI,CAACF,CAAC,CAAGA,CAAC,CAAGC,CAAC,CAAGA,CAAC,EAEfH,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAE,AAC5B,CAAC,SAEQI,CAAe,CACtB,CAAET,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAW,CAC3BO,CAAK,CAAG,GAAG,CACXb,CAAK,CAAG,CAAC,CACG,CACZ,MAAMc,CAAK,CAAG,IAAIC,KAAK,CAACF,CAAK,EAC7B,IAAK,IAAIG,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAGH,CAAK,CAAEG,CAAC,GAC1BF,CAAK,CAACE,CAAC,EAAId,CAAc,CAAC,CAAEC,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAE,CAAEN,CAAK,EAErD,OAAOc,CAAK,AACd,CAAC,SAEQG,CAAa,CAACC,CAAqB,CAAEC,CAAa,CAAEC,CAAc,CAAE,CAC3E,MAGMf,CAAE,CAAGc,CAAK,CAHE,CAAC,CAIbb,CAAE,CAAGc,CAAM,CAJC,CAAC,CAKbP,CAAK,CAAGK,CAAS,CAACG,MAAM,CAE9B,IAAK,IAAIL,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAGH,CAAK,CAAEG,CAAC,GAAI,CAC9B,IAAIM,CAAQ,CAAGJ,CAAS,CAACF,CAAC,EAE1B,MAAMO,CAAE,CAAGD,CAAQ,CAACb,CAAC,CAAGa,CAAQ,CAACf,EAAE,CAC7BiB,CAAE,CAAGF,CAAQ,CAACZ,CAAC,CAAGY,CAAQ,CAACd,EAAE,CACnCc,CAAQ,CAACb,CAAC,CAAGc,CAAE,CACfD,CAAQ,CAACZ,CAAC,CAAGc,CAAE,CACfF,CAAQ,CAACrB,CAAC,CAAGX,IAAI,CAACqB,IAAI,CAACY,CAAE,CAAGA,CAAE,CAAGC,CAAE,CAAGA,CAAE,GAgBpCD,CAAE,CA7BG,CAAa,EA6BPA,CAAE,CAAGlB,CAAE,IACpBiB,CAAQ,CAACf,EAAE,EAAIe,CAAQ,CAACf,EAAE,GAGxBiB,CAAE,CAhCG,CAAa,EAgCPA,CAAE,CAAGlB,CAAE,IACpBgB,CAAQ,CAACd,EAAE,EAAIc,CAAQ,CAACd,EAAE,EAE7B,AACH,UChFSiB,CAAO,CAACC,CAAyB,CAAE,CAC1C,UAAa,CACX,MAAMP,CAAK,CAAGO,CAAM,CAACC,WAAW,CAC1BP,CAAM,CAAGM,CAAM,CAACE,YAAY,CAGlC,OAFAF,CAAM,CAACP,KAAK,CAAGA,CAAK,CACpBO,CAAM,CAACN,MAAM,CAAGA,CAAM,CACf,CAAED,KAAK,CAALA,CAAK,CAAEC,MAAM,CAANA,CAAM,CAAE,CACzB,AACH,CAAC,AAED,MAAMS,CAAW,CAAIC,CAAa,EACrB,IAAI,EAAfA,CAAO,CAAW,EAAE,CAAGf,KAAK,CAACgB,OAAO,CAACD,CAAO,EAAIA,CAAO,CAAG,CAACA,CAAO,CAAC,UAG5DE,CAAY,CAACd,CAAqB,CAAEe,CAAgB,CAAE,CAC7D,MAAMC,CAAM,CAAmB,IAAInB,KAAK,GAexC,OAbAG,CAAS,CAACiB,OAAO,CAAEb,CAAQ,EAAK,CAC9B,MAAMc,CAAG,CAAGtC,CAAK,CAACwB,CAAQ,CAACZ,CAAC,CAAGuB,CAAQ,EACjCI,CAAG,CAAGvC,CAAK,CAACwB,CAAQ,CAACb,CAAC,CAAGwB,CAAQ,EAEpB,IAAI,EAAnBC,CAAM,CAACE,CAAG,IACZF,CAAM,CAACE,CAAG,EAAI,EAAE,EAEM,IAAI,EAAxBF,CAAM,CAACE,CAAG,EAAEC,CAAG,IACjBH,CAAM,CAACE,CAAG,EAAEC,CAAG,EAAI,EAAE,EAEvBH,CAAM,CAACE,CAAG,EAAEC,CAAG,EAAEC,IAAI,CAAChB,CAAQ,EAC/B,EAEMY,CAAM,AACf,CAAC,AAED,MAAMK,CAAQ,EACZL,CAAsB,CACtBE,CAAW,CACXI,CAAc,GACCX,CAAW,CAACA,CAAW,CAACK,CAAM,CAACE,CAAG,GAAGI,CAAM,YAEnDC,CAAI,CACXf,CAAyB,CACzBR,CAAqB,CACrB,CAAEe,QAAQ,CAARA,CAAQ,CAAES,WAAW,CAAXA,CAAW,CAAEC,SAAS,CAATA,CAAS,CAAEC,IAAI,CAAJA,CAAI,CAAE,CAC1C,CACA,KAAM,CAAEzB,KAAK,CAALA,CAAK,CAAEC,MAAM,CAANA,CAAM,CAAE,CAAGM,CAAM,CAC1BmB,CAAO,CAAGnB,CAAM,CAACoB,UAAU,CAAC,MAC5BC,CAAO,CAAGzD,IAAI,CAACO,IAAI,CAACsB,CAAK,CAAGc,CAAQ,EACpCe,CAAI,CAAG1D,IAAI,CAACO,IAAI,CAACuB,CAAM,CAAGa,CAAQ,EAClCC,CAAM,CAAGF,CAAY,CAACd,CAAS,CAAEe,CAAQ,EACzCgB,CAAc,CAAGhB,CAAQ,CAAGA,CAAQ,CACpCiB,CAAQ,CAAGN,CAAI,CAAG,CAAC,CAEnBO,CAAQ,EAAIC,CAAW,CAAEC,CAAW,GAAK,CAC7C,MAAMC,CAAE,CAAGF,CAAC,CAAC3C,CAAC,CAAG4C,CAAC,CAAC5C,CAAC,CACd8C,CAAE,CAAGH,CAAC,CAAC1C,CAAC,CAAG2C,CAAC,CAAC3C,CAAC,CAEhB4C,CAAE,CAAGA,CAAE,CAAGC,CAAE,CAAGA,CAAE,CAAGN,CAAc,GACpCJ,CAAO,CAACW,MAAM,CAACJ,CAAC,CAAC3C,CAAC,CAAE2C,CAAC,CAAC1C,CAAC,EACvBmC,CAAO,CAACY,MAAM,CAACJ,CAAC,CAAC5C,CAAC,CAAE4C,CAAC,CAAC3C,CAAC,GAE1B,CAEDmC,CAAO,CAACa,SAAS,GACjBb,CAAO,CAACc,SAAS,CAAC,CAAC,CAAE,CAAC,CAAExC,CAAK,CAAEC,CAAM,EACrCyB,CAAO,CAACF,SAAS,CAAGA,CAAS,CAC7BE,CAAO,CAACH,WAAW,CAAGA,CAAW,CAGjC,IAAK,IAAIN,CAAG,CAAG,CAAC,CAAEA,CAAG,CAAGY,CAAI,CAAEZ,CAAG,GAC/B,IAAK,IAAII,CAAM,CAAG,CAAC,CAAEA,CAAM,CAAGO,CAAO,CAAEP,CAAM,GAAI,CAC/C,MAAMoB,CAAK,CAAerB,CAAQ,CAACL,CAAM,CAAEE,CAAG,CAAEI,CAAM,EAChDqB,CAAU,CAAG,EAAE,CAACC,MAAM,CAC1BvB,CAAQ,CAACL,CAAM,CAAEE,CAAG,CAAEI,CAAM,CAAG,CAAC,EAChCD,CAAQ,CAACL,CAAM,CAAEE,CAAG,CAAG,CAAC,CAAEI,CAAM,EAChCD,CAAQ,CAACL,CAAM,CAAEE,CAAG,CAAG,CAAC,CAAEI,CAAM,CAAG,CAAC,GAGhCuB,CAAS,CAAG,IAAIC,GAAG,GAEzBJ,CAAK,CAACzB,OAAO,CAAEb,CAAQ,EAAK,CAC1ByC,CAAS,CAACE,GAAG,CAAC3C,CAAQ,EAGtBsC,CAAK,CAACzB,OAAO,CAAE+B,CAAS,EAAK,CACtBH,CAAS,CAACI,GAAG,CAACD,CAAS,GAC1Bf,CAAQ,CAAC7B,CAAQ,CAAE4C,CAAS,EAE/B,EAGDL,CAAU,CAAC1B,OAAO,CAAE+B,CAAS,EAAK,CAChCf,CAAQ,CAAC7B,CAAQ,CAAE4C,CAAS,EAC7B,EAEDrB,CAAO,CAACuB,QAAQ,CACd9C,CAAQ,CAACb,CAAC,CAAGyC,CAAQ,CACrB5B,CAAQ,CAACZ,CAAC,CAAGwC,CAAQ,CACrBN,CAAI,CACJA,CAAI,EAEP,EACF,AAGHC,CAAO,CAACwB,MAAM,GACdxB,CAAO,CAACyB,OAAO,EACjB,UC/FgBC,CAAI,CAAC7C,CAAyB,CAAE8C,CAAc,CAAE,CAC9D,GAAI,CACF3D,KAAK,CAALA,CAAK,CAAG,GAAG,CACXoB,QAAQ,CAARA,CAAQ,CAAG,GAAG,CACdjC,KAAK,CAALA,CAAK,CAAG,CAAC,CACTyE,OAAO,CAAPA,CAAO,EAAG,CAAI,CACd/B,WAAW,CAAXA,CAAW,CAAG,kBACdC,SAAS,CAATA,CAAS,CAAG,QACZC,IAAI,CAAJA,CAAI,CAAG,CAAC,CACT,CAAG4B,CAAM,CACV,MAAME,CAAQ,CAAGjD,CAAO,CAACC,CAAM,EACzB,CAAEP,KAAK,CAALA,CAAK,CAAEC,MAAM,CAANA,CAAM,CAAE,CAAGsD,CAAQ,GAC5BxD,CAAS,CAAGN,CAAe,CAC/B,CACET,EAAE,CAAE,CAAC,CACLC,EAAE,CAAE,CAAC,CACLC,EAAE,CAAEc,CAAK,CACTb,EAAE,CAAEc,CAAM,CACX,CACDP,CAAK,CACLb,CAAK,EAGPT,CAAG,CAACoF,gBAAgB,CAAChF,CAAiB,CAAE+E,CAAQ,EAEhD,IAAIE,CAAY,CAAG,CAAC,UAEXC,CAAM,CAACC,CAAS,CAAG,CAAC,CAAE,CACzBA,CAAS,CAAGF,CAAY,CAAG,EAAE,GAC/BnC,CAAI,CAACf,CAAM,CAAER,CAAS,CAAE,CAAEe,QAAQ,CAARA,CAAQ,CAAES,WAAW,CAAXA,CAAW,CAAEC,SAAS,CAATA,CAAS,CAAEC,IAAI,CAAJA,CAAI,CAAE,EAClE3B,CAAa,CAACC,CAAS,CAAEC,CAAK,CAAEC,CAAM,EACtCwD,CAAY,CAAGE,CAAS,GAGV,CAAK,GAAjBL,CAAO,EACThF,CAAiB,CAACoF,CAAM,EAE3B,AAGD,OAFApF,CAAiB,CAACoF,CAAM,MAEX,CACXJ,CAAO,EAAG,CAAK,CACflF,CAAG,CAACwF,mBAAmB,CAACpF,CAAiB,CAAE+E,CAAQ,EACpD,AACH"}