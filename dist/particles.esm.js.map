{"version":3,"file":"particles.esm.js","sources":["../src/contants.ts","../src/particles.ts","../src/canvas.ts","../src/main.ts"],"sourcesContent":["const math = Math;\n\nexport const win = window;\nexport const reqAnimationFrame = window.requestAnimationFrame;\nexport const EVENT_NAME_RESIZE = \"resize\";\nexport const random = math.random;\nexport const ceil = math.ceil;\nexport const floor = math.floor;\n","import { ceil, random } from \"./contants\";\n\nexport type Particle = {\n  x: number;\n  y: number;\n  r: number;\n  vx: number;\n  vy: number;\n};\n\ntype Boundry = {\n  x1: number;\n  x2: number;\n  y1: number;\n  y2: number;\n};\n\nconst randomVelocity = (speed: number): number => {\n  const r = ceil(random() * speed);\n  return (random() > 0.5 ? 1 : -1) * (r === 0 ? randomVelocity(speed) : r);\n};\n\nfunction createParticle({ x1, y1, x2, y2 }: Boundry, speed: number): Particle {\n  const vx = randomVelocity(speed);\n  const vy = randomVelocity(speed);\n  const x = x1 + ceil(random() * x2);\n  const y = y1 + ceil(random() * y2);\n  const r = Math.sqrt(x * x + y * y) | 0;\n\n  return { x, y, r, vx, vy };\n}\n\nfunction createParticles(\n  { x1, y1, x2, y2 }: Boundry,\n  count = 200,\n  speed = 4\n): Particle[] {\n  const array = new Array(count);\n  for (let i = 0; i < count; i++) {\n    array[i] = createParticle({ x1, y1, x2, y2 }, speed);\n  }\n  return array;\n}\n\nfunction moveParticles(particles: Particle[], width: number, height: number) {\n  const threshold = 0;\n  const x1 = 0 - threshold;\n  const y1 = 0 - threshold;\n  const x2 = width + threshold;\n  const y2 = height + threshold;\n  const count = particles.length;\n\n  for (let i = 0; i < count; i++) {\n    let particle = particles[i];\n\n    const pX = particle.x + particle.vx;\n    const pY = particle.y + particle.vy;\n    particle.x = pX;\n    particle.y = pY;\n    particle.r = Math.sqrt(pX * pX + pY * pY);\n\n    /*\n    if (pX < x1) {\n      particle.x = x2;\n    } else if (pX > x2) {\n      particle.x = x1;\n    }\n\n    if (pY < y1) {\n      particle.y = y2;\n    } else if (pY > y2) {\n      particle.y = y1;\n    }\n    */\n\n    if (pX < x1 || pX > x2) {\n      particle.vx = -particle.vx;\n    }\n\n    if (pY < y1 || pY > y2) {\n      particle.vy = -particle.vy;\n    }\n  }\n}\n\nexport { createParticles, moveParticles };\n","import { floor } from \"./contants\";\nimport type { Particle } from \"./particles\";\n\nfunction resizer(canvas: HTMLCanvasElement) {\n  return () => {\n    const width = canvas.offsetWidth;\n    const height = canvas.offsetHeight;\n    canvas.width = width;\n    canvas.height = height;\n    return { width, height };\n  };\n}\n\nconst ensureArray = (subject?: any) =>\n  subject == null ? [] : Array.isArray(subject) ? subject : [subject];\n\n// devide & rule\nfunction createMatrix(particles: Particle[], distance: number) {\n  const matrix: Particle[][][] = new Array();\n\n  particles.forEach((particle) => {\n    const row = floor(particle.y / distance);\n    const col = floor(particle.x / distance);\n\n    if (matrix[row] == null) {\n      matrix[row] = [];\n    }\n    if (matrix[row][col] == null) {\n      matrix[row][col] = [] as Particle[];\n    }\n    matrix[row][col].push(particle);\n  });\n\n  return matrix;\n}\n\nconst getBlock = (\n  matrix: Particle[][][],\n  row: number,\n  column: number\n): Particle[] => ensureArray(ensureArray(matrix[row])[column]);\n\nfunction draw(\n  canvas: HTMLCanvasElement,\n  particles: Particle[],\n  { distance, strokeStyle, fillStyle, size }\n) {\n  const { width, height } = canvas;\n  const context = canvas.getContext(\"2d\");\n  const columns = Math.ceil(width / distance);\n  const rows = Math.ceil(height / distance);\n  const matrix = createMatrix(particles, distance);\n  const distanceSquare = distance * distance;\n  const halfSize = size / 2;\n\n  const drawLine = (a: Particle, b: Particle) => {\n    const dx = a.x - b.x;\n    const dy = a.y - b.y;\n\n    if (dx * dx + dy * dy < distanceSquare) {\n      context.moveTo(a.x, a.y);\n      context.lineTo(b.x, b.y);\n    }\n  };\n\n  context.beginPath();\n  context.clearRect(0, 0, width, height);\n  context.fillStyle = fillStyle;\n  context.strokeStyle = strokeStyle;\n\n  // run loop for Row-x-Column matrix\n  for (let row = 0; row < rows; row++) {\n    for (let column = 0; column < columns; column++) {\n      const block: Particle[] = getBlock(matrix, row, column);\n      const neighbours = [].concat(\n        getBlock(matrix, row, column + 1),\n        getBlock(matrix, row + 1, column),\n        getBlock(matrix, row + 1, column + 1)\n      );\n\n      const processed = new Set();\n\n      block.forEach((particle) => {\n        processed.add(particle);\n\n        // run for neighbour points within block\n        block.forEach((neighbour) => {\n          if (!processed.has(neighbour)) {\n            drawLine(particle, neighbour);\n          }\n        });\n\n        // run for neighbour points in adjacent blocks\n        neighbours.forEach((neighbour) => {\n          drawLine(particle, neighbour);\n        });\n\n        context.fillRect(\n          particle.x - halfSize,\n          particle.y - halfSize,\n          size,\n          size\n        );\n      });\n    }\n  }\n\n  context.stroke();\n  context.restore();\n}\n\nexport { resizer, draw };\n","import { createParticles, moveParticles } from \"./particles\";\nimport { draw, resizer } from \"./canvas\";\nimport { win, reqAnimationFrame, EVENT_NAME_RESIZE } from \"./contants\";\n\ntype Config = {\n  count: number;\n  distance: number;\n  speed: number;\n  animate: boolean;\n  strokeStyle: string;\n  fillStyle: string;\n  size: number;\n};\n\nexport function init(canvas: HTMLCanvasElement, config: Config) {\n  var {\n    count = 500,\n    distance = 100,\n    speed = 4,\n    animate = true,\n    strokeStyle = \"rgba(0,0,0,0.1)\",\n    fillStyle = \"black\",\n    size = 2,\n  } = config;\n  const onResize = resizer(canvas);\n  const { width, height } = onResize();\n  const particles = createParticles(\n    {\n      x1: 0,\n      y1: 0,\n      x2: width,\n      y2: height,\n    },\n    count,\n    speed\n  );\n\n  win.addEventListener(EVENT_NAME_RESIZE, onResize);\n\n  let oldTimestamp = 0;\n\n  function redraw(timestamp = 0) {\n    if (timestamp - oldTimestamp > 16) {\n      draw(canvas, particles, { distance, strokeStyle, fillStyle, size });\n      moveParticles(particles, width, height);\n      oldTimestamp = timestamp;\n    }\n\n    if (animate !== false) {\n      reqAnimationFrame(redraw);\n    }\n  }\n  reqAnimationFrame(redraw);\n\n  return () => {\n    animate = false;\n    win.removeEventListener(EVENT_NAME_RESIZE, onResize);\n  };\n}\n"],"names":["math","Math","win","window","reqAnimationFrame","requestAnimationFrame","EVENT_NAME_RESIZE","random","ceil","floor","randomVelocity","speed","r","createParticle","x1","y1","x2","y2","vx","vy","x","y","sqrt","ensureArray","subject","Array","isArray","getBlock","matrix","row","column","init","canvas","config","count","distance","animate","strokeStyle","fillStyle","size","onResize","width","offsetWidth","height","offsetHeight","particles","array","i","addEventListener","oldTimestamp","redraw","timestamp","context","getContext","columns","rows","forEach","particle","col","push","distanceSquare","halfSize","drawLine","a","b","dx","dy","moveTo","lineTo","beginPath","clearRect","block","neighbours","concat","processed","Set","add","neighbour","has","fillRect","stroke","restore","length","pX","pY","removeEventListener"],"mappings":"AAAA,MAAMA,CAAI,CAAGC,IAAI,CAEJC,CAAG,CAAGC,MAAM,CACZC,CAAiB,CAAGD,MAAM,CAACE,qBAAqB,CAChDC,CAAiB,CAAG,SACpBC,CAAM,CAAGP,CAAI,CAACO,MAAM,CACpBC,CAAI,CAAGR,CAAI,CAACQ,IAAI,CAChBC,CAAK,CAAGT,CAAI,CAACS,KAAK,CCUzBC,CAAc,CAAIC,CAAa,EAAa,CAChD,MAAMC,CAAC,CAAGJ,CAAI,CAACD,CAAM,GAAKI,CAAK,EAC/B,OAAQJ,CAAM,GAAK,GAAG,CAAG,CAAC,GAAK,GAAW,CAAC,GAAPK,CAAC,CAASF,CAAc,CAACC,CAAK,EAAIC,CAAC,CACzE,CAAC,UAEQC,CAAc,CAAC,CAAEC,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAW,CAAEN,CAAa,CAAY,CAC5E,MAAMO,CAAE,CAAGR,CAAc,CAACC,CAAK,EACzBQ,CAAE,CAAGT,CAAc,CAACC,CAAK,EACzBS,CAAC,CAAGN,CAAE,CAAGN,CAAI,CAACD,CAAM,GAAKS,CAAE,EAC3BK,CAAC,CAAGN,CAAE,CAAGP,CAAI,CAACD,CAAM,GAAKU,CAAE,EAGjC,MAAO,CAAEG,CAAC,CAADA,CAAC,CAAEC,CAAC,CAADA,CAAC,CAAET,CAAC,CAFqB,CAAC,CAA5BX,IAAI,CAACqB,IAAI,CAACF,CAAC,CAAGA,CAAC,CAAGC,CAAC,CAAGA,CAAC,EAEfH,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAE,AAC5B,CAAC,ACjBD,MAAMI,CAAW,CAAIC,CAAa,EACrB,IAAI,EAAfA,CAAO,CAAW,EAAE,CAAGC,KAAK,CAACC,OAAO,CAACF,CAAO,EAAIA,CAAO,CAAG,CAACA,CAAO,CAAC,CAsB/DG,CAAQ,EACZC,CAAsB,CACtBC,CAAW,CACXC,CAAc,GACCP,CAAW,CAACA,CAAW,CAACK,CAAM,CAACC,CAAG,GAAGC,CAAM,YC1B5CC,CAAI,CAACC,CAAyB,CAAEC,CAAc,CAAE,CAC9D,IDZeD,CAAyB,CCYpC,CACFE,KAAK,CAALA,CAAK,CAAG,GAAG,CACXC,QAAQ,CAARA,CAAQ,CAAG,GAAG,CACdxB,KAAK,CAALA,CAAK,CAAG,CAAC,CACTyB,OAAO,CAAPA,CAAO,EAAG,CAAI,CACdC,WAAW,CAAXA,CAAW,CAAG,kBACdC,SAAS,CAATA,CAAS,CAAG,QACZC,IAAI,CAAJA,CAAI,CAAG,CAAC,CACT,CAAGN,CAAM,CACV,MAAMO,CAAQ,EDrBCR,CAAyB,CCqBfA,CAAM,KDpBlB,CACX,MAAMS,CAAK,CAAGT,CAAM,CAACU,WAAW,CAC1BC,CAAM,CAAGX,CAAM,CAACY,YAAY,CAGlC,OAFAZ,CAAM,CAACS,KAAK,CAAGA,CAAK,CACpBT,CAAM,CAACW,MAAM,CAAGA,CAAM,CACf,CAAEF,KAAK,CAALA,CAAK,CAAEE,MAAM,CAANA,CAAM,CAAE,CACzB,ECeK,CAAEF,KAAK,CAALA,CAAK,CAAEE,MAAM,CAANA,CAAM,CAAE,CAAGH,CAAQ,GAC5BK,CAAS,UFOf,CAAE/B,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAW,CAC3BiB,CAAK,CAAG,GAAG,CACXvB,CAAK,CAAG,CAAC,CACG,CACZ,MAAMmC,CAAK,CAAG,IAAIrB,KAAK,CAACS,CAAK,EAC7B,IAAK,IAAIa,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAGb,CAAK,CAAEa,CAAC,GAC1BD,CAAK,CAACC,CAAC,EAAIlC,CAAc,CAAC,CAAEC,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAEC,EAAE,CAAFA,CAAE,CAAE,CAAEN,CAAK,EAErD,OAAOmC,CAAK,AACd,CAAC,CEfG,CACEhC,EAAE,CAAE,CAAC,CACLC,EAAE,CAAE,CAAC,CACLC,EAAE,CAAEyB,CAAK,CACTxB,EAAE,CAAE0B,CAAM,CACX,CACDT,CAAK,CACLvB,CAAK,EAGPT,CAAG,CAAC8C,gBAAgB,CAAC1C,CAAiB,CAAEkC,CAAQ,EAEhD,IAAIS,CAAY,CAAG,CAAC,UAEXC,CAAM,CAACC,CAAS,CAAG,CAAC,CAAE,CACzBA,CAAS,CAAGF,CAAY,CAAG,EAAE,aDCnCjB,CAAyB,CACzBa,CAAqB,CACrB,CAAEV,QAAQ,CAARA,CAAQ,CAAEE,WAAW,CAAXA,CAAW,CAAEC,SAAS,CAATA,CAAS,CAAEC,IAAI,CAAJA,CAAI,CAAE,CAC1C,CACA,KAAM,CAAEE,KAAK,CAALA,CAAK,CAAEE,MAAM,CAANA,CAAM,CAAE,CAAGX,CAAM,CAC1BoB,CAAO,CAAGpB,CAAM,CAACqB,UAAU,CAAC,MAC5BC,CAAO,CAAGrD,IAAI,CAACO,IAAI,CAACiC,CAAK,CAAGN,CAAQ,EACpCoB,CAAI,CAAGtD,IAAI,CAACO,IAAI,CAACmC,CAAM,CAAGR,CAAQ,EAClCP,CAAM,UAlCQiB,CAAqB,CAAEV,CAAgB,CAAE,CAC7D,MAAMP,CAAM,CAAmB,IAAIH,KAAK,GAexC,OAbAoB,CAAS,CAACW,OAAO,CAAEC,CAAQ,EAAK,CAC9B,MAAM5B,CAAG,CAAGpB,CAAK,CAACgD,CAAQ,CAACpC,CAAC,CAAGc,CAAQ,EACjCuB,CAAG,CAAGjD,CAAK,CAACgD,CAAQ,CAACrC,CAAC,CAAGe,CAAQ,EAEpB,IAAI,EAAnBP,CAAM,CAACC,CAAG,IACZD,CAAM,CAACC,CAAG,EAAI,EAAE,EAEM,IAAI,EAAxBD,CAAM,CAACC,CAAG,EAAE6B,CAAG,IACjB9B,CAAM,CAACC,CAAG,EAAE6B,CAAG,EAAI,EAAE,EAEvB9B,CAAM,CAACC,CAAG,EAAE6B,CAAG,EAAEC,IAAI,CAACF,CAAQ,EAC/B,EAEM7B,CAAM,AACf,CAAC,CAiB6BiB,CAAS,CAAEV,CAAQ,EACzCyB,CAAc,CAAGzB,CAAQ,CAAGA,CAAQ,CACpC0B,CAAQ,CAAGtB,CAAI,CAAG,CAAC,CAEnBuB,CAAQ,EAAIC,CAAW,CAAEC,CAAW,GAAK,CAC7C,MAAMC,CAAE,CAAGF,CAAC,CAAC3C,CAAC,CAAG4C,CAAC,CAAC5C,CAAC,CACd8C,CAAE,CAAGH,CAAC,CAAC1C,CAAC,CAAG2C,CAAC,CAAC3C,CAAC,CAEhB4C,CAAE,CAAGA,CAAE,CAAGC,CAAE,CAAGA,CAAE,CAAGN,CAAc,GACpCR,CAAO,CAACe,MAAM,CAACJ,CAAC,CAAC3C,CAAC,CAAE2C,CAAC,CAAC1C,CAAC,EACvB+B,CAAO,CAACgB,MAAM,CAACJ,CAAC,CAAC5C,CAAC,CAAE4C,CAAC,CAAC3C,CAAC,GAE1B,CAED+B,CAAO,CAACiB,SAAS,GACjBjB,CAAO,CAACkB,SAAS,CAAC,CAAC,CAAE,CAAC,CAAE7B,CAAK,CAAEE,CAAM,EACrCS,CAAO,CAACd,SAAS,CAAGA,CAAS,CAC7Bc,CAAO,CAACf,WAAW,CAAGA,CAAW,CAGjC,IAAK,IAAIR,CAAG,CAAG,CAAC,CAAEA,CAAG,CAAG0B,CAAI,CAAE1B,CAAG,GAC/B,IAAK,IAAIC,CAAM,CAAG,CAAC,CAAEA,CAAM,CAAGwB,CAAO,CAAExB,CAAM,GAAI,CAC/C,MAAMyC,CAAK,CAAe5C,CAAQ,CAACC,CAAM,CAAEC,CAAG,CAAEC,CAAM,EAChD0C,CAAU,CAAG,EAAE,CAACC,MAAM,CAC1B9C,CAAQ,CAACC,CAAM,CAAEC,CAAG,CAAEC,CAAM,CAAG,CAAC,EAChCH,CAAQ,CAACC,CAAM,CAAEC,CAAG,CAAG,CAAC,CAAEC,CAAM,EAChCH,CAAQ,CAACC,CAAM,CAAEC,CAAG,CAAG,CAAC,CAAEC,CAAM,CAAG,CAAC,GAGhC4C,CAAS,CAAG,IAAIC,GAAG,GAEzBJ,CAAK,CAACf,OAAO,CAAEC,CAAQ,EAAK,CAC1BiB,CAAS,CAACE,GAAG,CAACnB,CAAQ,EAGtBc,CAAK,CAACf,OAAO,CAAEqB,CAAS,EAAK,CACtBH,CAAS,CAACI,GAAG,CAACD,CAAS,GAC1Bf,CAAQ,CAACL,CAAQ,CAAEoB,CAAS,EAE/B,EAGDL,CAAU,CAAChB,OAAO,CAAEqB,CAAS,EAAK,CAChCf,CAAQ,CAACL,CAAQ,CAAEoB,CAAS,EAC7B,EAEDzB,CAAO,CAAC2B,QAAQ,CACdtB,CAAQ,CAACrC,CAAC,CAAGyC,CAAQ,CACrBJ,CAAQ,CAACpC,CAAC,CAAGwC,CAAQ,CACrBtB,CAAI,CACJA,CAAI,EAEP,EACF,AAGHa,CAAO,CAAC4B,MAAM,GACd5B,CAAO,CAAC6B,OAAO,EACjB,GClEWjD,CAAM,CAAEa,CAAS,CAAE,CAAEV,QAAQ,CAARA,CAAQ,CAAEE,WAAW,CAAXA,CAAW,CAAEC,SAAS,CAATA,CAAS,CAAEC,IAAI,CAAJA,CAAI,CAAE,YFCjDM,CAAqB,CAAEJ,CAAa,CAAEE,CAAc,CAAE,CAE3E,MAEM3B,CAAE,CAAGyB,CAAK,CAHE,CAAC,CAIbxB,CAAE,CAAG0B,CAAM,CAJC,CAAC,CAKbT,CAAK,CAAGW,CAAS,CAACqC,MAAM,CAE9B,IAAK,IAAInC,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAGb,CAAK,CAAEa,CAAC,GAAI,CAC9B,IAAIU,CAAQ,CAAGZ,CAAS,CAACE,CAAC,EAE1B,MAAMoC,CAAE,CAAG1B,CAAQ,CAACrC,CAAC,CAAGqC,CAAQ,CAACvC,EAAE,CAC7BkE,CAAE,CAAG3B,CAAQ,CAACpC,CAAC,CAAGoC,CAAQ,CAACtC,EAAE,CACnCsC,CAAQ,CAACrC,CAAC,CAAG+D,CAAE,CACf1B,CAAQ,CAACpC,CAAC,CAAG+D,CAAE,CACf3B,CAAQ,CAAC7C,CAAC,CAAGX,IAAI,CAACqB,IAAI,CAAC6D,CAAE,CAAGA,CAAE,CAAGC,CAAE,CAAGA,CAAE,GAgBpCD,CAAE,CA7BG,CAAa,EA6BPA,CAAE,CAAGnE,CAAE,IACpByC,CAAQ,CAACvC,EAAE,EAAIuC,CAAQ,CAACvC,EAAE,GAGxBkE,CAAE,CAhCG,CAAa,EAgCPA,CAAE,CAAGnE,CAAE,IACpBwC,CAAQ,CAACtC,EAAE,EAAIsC,CAAQ,CAACtC,EAAE,EAE7B,AACH,GEvCoB0B,CAAS,CAAEJ,CAAK,CAAEE,CAAM,EACtCM,CAAY,CAAGE,CAAS,GAGV,CAAK,GAAjBf,CAAO,EACThC,CAAiB,CAAC8C,CAAM,EAE3B,AAGD,OAFA9C,CAAiB,CAAC8C,CAAM,MAEX,CACXd,CAAO,EAAG,CAAK,CACflC,CAAG,CAACmF,mBAAmB,CAAC/E,CAAiB,CAAEkC,CAAQ,EACpD,AACH"}