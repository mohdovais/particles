{"version":3,"file":"particles.umd.js","sources":["../src/particles.ts","../src/canvas.ts","../src/contants.ts","../src/main.ts"],"sourcesContent":["import { ceil, random } from \"./contants\";\n\nexport type Particle = {\n  x: number;\n  y: number;\n  r: number;\n  vx: number;\n  vy: number;\n};\n\ntype Boundry = {\n  x1: number;\n  x2: number;\n  y1: number;\n  y2: number;\n};\n\nconst randomVelocity = (speed: number): number => {\n  const r = ceil(random() * speed);\n  return (random() > 0.5 ? 1 : -1) * (r === 0 ? randomVelocity(speed) : r);\n};\n\nfunction createParticle({ x1, y1, x2, y2 }: Boundry, speed: number): Particle {\n  const vx = randomVelocity(speed);\n  const vy = randomVelocity(speed);\n  const x = x1 + ceil(random() * x2);\n  const y = y1 + ceil(random() * y2);\n  const r = Math.sqrt(x * x + y * y) | 0;\n\n  return { x, y, r, vx, vy };\n}\n\nfunction createParticles(\n  { x1, y1, x2, y2 }: Boundry,\n  count = 200,\n  speed = 4\n): Particle[] {\n  const array = new Array(count);\n  for (let i = 0; i < count; i++) {\n    array[i] = createParticle({ x1, y1, x2, y2 }, speed);\n  }\n  return array;\n}\n\nfunction moveParticles(particles: Particle[], width: number, height: number) {\n  const threshold = 0;\n  const x1 = 0 - threshold;\n  const y1 = 0 - threshold;\n  const x2 = width + threshold;\n  const y2 = height + threshold;\n  const count = particles.length;\n\n  for (let i = 0; i < count; i++) {\n    let particle = particles[i];\n\n    const pX = particle.x + particle.vx;\n    const pY = particle.y + particle.vy;\n    particle.x = pX;\n    particle.y = pY;\n    particle.r = Math.sqrt(pX * pX + pY * pY);\n\n    /*\n    if (pX < x1) {\n      particle.x = x2;\n    } else if (pX > x2) {\n      particle.x = x1;\n    }\n\n    if (pY < y1) {\n      particle.y = y2;\n    } else if (pY > y2) {\n      particle.y = y1;\n    }\n    */\n\n    if (pX < x1 || pX > x2) {\n      particle.vx = -particle.vx;\n    }\n\n    if (pY < y1 || pY > y2) {\n      particle.vy = -particle.vy;\n    }\n  }\n}\n\nexport { createParticles, moveParticles };\n","import { floor } from \"./contants\";\nimport type { Particle } from \"./particles\";\n\nfunction resizer(canvas: HTMLCanvasElement) {\n  return () => {\n    const width = canvas.offsetWidth;\n    const height = canvas.offsetHeight;\n    canvas.width = width;\n    canvas.height = height;\n    return { width, height };\n  };\n}\n\nconst ensureArray = (subject?: any) =>\n  subject == null ? [] : Array.isArray(subject) ? subject : [subject];\n\n// devide & rule\nfunction createMatrix(particles: Particle[], distance: number) {\n  const matrix: Particle[][][] = new Array();\n\n  particles.forEach((particle) => {\n    const row = floor(particle.y / distance);\n    const col = floor(particle.x / distance);\n\n    if (matrix[row] == null) {\n      matrix[row] = [];\n    }\n    if (matrix[row][col] == null) {\n      matrix[row][col] = [] as Particle[];\n    }\n    matrix[row][col].push(particle);\n  });\n\n  return matrix;\n}\n\nconst getBlock = (\n  matrix: Particle[][][],\n  row: number,\n  column: number\n): Particle[] => ensureArray(ensureArray(matrix[row])[column]);\n\nfunction draw(\n  canvas: HTMLCanvasElement,\n  particles: Particle[],\n  { distance, strokeStyle, fillStyle, size }\n) {\n  const { width, height } = canvas;\n  const context = canvas.getContext(\"2d\");\n  const columns = Math.ceil(width / distance);\n  const rows = Math.ceil(height / distance);\n  const matrix = createMatrix(particles, distance);\n  const distanceSquare = distance * distance;\n  const halfSize = size / 2;\n\n  const drawLine = (a: Particle, b: Particle) => {\n    const dx = a.x - b.x;\n    const dy = a.y - b.y;\n\n    if (dx * dx + dy * dy < distanceSquare) {\n      context.moveTo(a.x, a.y);\n      context.lineTo(b.x, b.y);\n    }\n  };\n\n  context.beginPath();\n  context.clearRect(0, 0, width, height);\n  context.fillStyle = fillStyle;\n  context.strokeStyle = strokeStyle;\n\n  // run loop for Row-x-Column matrix\n  for (let row = 0; row < rows; row++) {\n    for (let column = 0; column < columns; column++) {\n      const block: Particle[] = getBlock(matrix, row, column);\n      const neighbours = [].concat(\n        getBlock(matrix, row, column + 1),\n        getBlock(matrix, row + 1, column),\n        getBlock(matrix, row + 1, column + 1)\n      );\n\n      const processed = new Set();\n\n      block.forEach((particle) => {\n        processed.add(particle);\n\n        // run for neighbour points within block\n        block.forEach((neighbour) => {\n          if (!processed.has(neighbour)) {\n            drawLine(particle, neighbour);\n          }\n        });\n\n        // run for neighbour points in adjacent blocks\n        neighbours.forEach((neighbour) => {\n          drawLine(particle, neighbour);\n        });\n\n        context.fillRect(\n          particle.x - halfSize,\n          particle.y - halfSize,\n          size,\n          size\n        );\n      });\n    }\n  }\n\n  context.stroke();\n  context.restore();\n}\n\nexport { resizer, draw };\n","const math = Math;\n\nexport const win = window;\nexport const reqAnimationFrame = window.requestAnimationFrame;\nexport const EVENT_NAME_RESIZE = \"resize\";\nexport const random = math.random;\nexport const ceil = math.ceil;\nexport const floor = math.floor;\n","import { createParticles, moveParticles } from \"./particles\";\nimport { draw, resizer } from \"./canvas\";\nimport { win, reqAnimationFrame, EVENT_NAME_RESIZE } from \"./contants\";\n\ntype Config = {\n  count: number;\n  distance: number;\n  speed: number;\n  animate: boolean;\n  strokeStyle: string;\n  fillStyle: string;\n  size: number;\n};\n\nexport function init(canvas: HTMLCanvasElement, config: Config) {\n  var {\n    count = 500,\n    distance = 100,\n    speed = 4,\n    animate = true,\n    strokeStyle = \"rgba(0,0,0,0.1)\",\n    fillStyle = \"black\",\n    size = 2,\n  } = config;\n  const onResize = resizer(canvas);\n  const { width, height } = onResize();\n  const particles = createParticles(\n    {\n      x1: 0,\n      y1: 0,\n      x2: width,\n      y2: height,\n    },\n    count,\n    speed\n  );\n\n  win.addEventListener(EVENT_NAME_RESIZE, onResize);\n\n  let oldTimestamp = 0;\n\n  function redraw(timestamp = 0) {\n    if (timestamp - oldTimestamp > 16) {\n      draw(canvas, particles, { distance, strokeStyle, fillStyle, size });\n      moveParticles(particles, width, height);\n      oldTimestamp = timestamp;\n    }\n\n    if (animate !== false) {\n      reqAnimationFrame(redraw);\n    }\n  }\n  reqAnimationFrame(redraw);\n\n  return () => {\n    animate = false;\n    win.removeEventListener(EVENT_NAME_RESIZE, onResize);\n  };\n}\n"],"names":["createParticle","param","speed","x1","y1","x2","y2","vx","randomVelocity","vy","x","ceil","random","y","r","Math","sqrt","createParticles","count","array","Array","i","moveParticles","particles","width","height","length","particle","pX","pY","createMatrix","distance","matrix","forEach","row","floor","col","push","draw","canvas","strokeStyle","fillStyle","size","context","getContext","columns","rows","distanceSquare","halfSize","drawLine","a","b","dx","dy","moveTo","lineTo","beginPath","clearRect","column","block","getBlock","neighbours","concat","processed","Set","add","neighbour","has","fillRect","stroke","restore","math","win","window","reqAnimationFrame","requestAnimationFrame","EVENT_NAME_RESIZE","ensureArray","subject","isArray","config","animate","onResize","offsetWidth","offsetHeight","addEventListener","oldTimestamp","redraw","timestamp","removeEventListener"],"mappings":"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"}