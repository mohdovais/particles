{"version":3,"file":"particles.umd.js","sources":["../src/particles.ts","../src/canvas.ts","../src/contants.ts","../src/main.ts"],"sourcesContent":["import { ceil, random } from \"./contants\";\n\nexport type Particle = {\n  x: number;\n  y: number;\n  r: number;\n  vx: number;\n  vy: number;\n};\n\ntype Boundry = {\n  x1: number;\n  x2: number;\n  y1: number;\n  y2: number;\n};\n\nconst randomVelocity = (speed: number): number => {\n  const r = ceil(random() * speed);\n  return (random() > 0.5 ? 1 : -1) * (r === 0 ? randomVelocity(speed) : r);\n};\n\nfunction createParticle({ x1, y1, x2, y2 }: Boundry, speed: number): Particle {\n  const vx = randomVelocity(speed);\n  const vy = randomVelocity(speed);\n  const x = x1 + ceil(random() * x2);\n  const y = y1 + ceil(random() * y2);\n  const r = Math.sqrt(x * x + y * y) | 0;\n\n  return { x, y, r, vx, vy };\n}\n\nfunction createParticles(\n  { x1, y1, x2, y2 }: Boundry,\n  count = 200,\n  speed = 4\n): Particle[] {\n  const array = new Array(count);\n  for (let i = 0; i < count; i++) {\n    array[i] = createParticle({ x1, y1, x2, y2 }, speed);\n  }\n  return array;\n}\n\nfunction moveParticles(particles: Particle[], width: number, height: number) {\n  const threshold = 100;\n  const x1 = 0 - threshold;\n  const y1 = 0 - threshold;\n  const x2 = width + threshold;\n  const y2 = height + threshold;\n  const count = particles.length;\n\n  for (let i = 0; i < count; i++) {\n    let particle = particles[i];\n\n    const pX = particle.x + particle.vx;\n    const pY = particle.y + particle.vy;\n    particle.x = pX;\n    particle.y = pY;\n    particle.r = Math.sqrt(pX * pX + pY * pY);\n\n    if (pX < x1 || pX > x2) {\n      particle.vx = -particle.vx;\n    }\n\n    if (pY < y1 || pY > y2) {\n      particle.vy = -particle.vy;\n    }\n  }\n}\n\nexport { createParticles, moveParticles };\n","import { floor } from \"./contants\";\nimport type { Particle } from \"./particles\";\n\nexport function resizer(canvas: HTMLCanvasElement) {\n  return () => {\n    const width = canvas.offsetWidth;\n    const height = canvas.offsetHeight;\n    canvas.width = width;\n    canvas.height = height;\n    return { width, height };\n  };\n}\n\nfunction createMatrix(particles: Particle[], distance: number) {\n  const matrix: Particle[][][] = new Array();\n\n  particles.forEach((particle) => {\n    const row = floor(particle.y / distance);\n    const col = floor(particle.x / distance);\n\n    if (matrix[row] == null) {\n      matrix[row] = [];\n    }\n    if (matrix[row][col] == null) {\n      matrix[row][col] = [] as Particle[];\n    }\n    matrix[row][col].push(particle);\n  });\n\n  return matrix;\n}\n\nconst ensureArray = (subject?: any) =>\n  subject == null ? [] : Array.isArray(subject) ? subject : [subject];\n\nconst getBlock = (\n  matrix: Particle[][][],\n  row: number,\n  column: number\n): Particle[] => ensureArray(ensureArray(matrix[row])[column]);\n\nexport function draw(\n  canvas: HTMLCanvasElement,\n  particles: Particle[],\n  { distance, strokeStyle, fillStyle, size = 2 }\n) {\n  const { width, height } = canvas;\n  const context = canvas.getContext(\"2d\");\n  context.fillStyle = fillStyle || \"black\";\n  context.strokeStyle = strokeStyle || \"rgba(0,0,0,0.1)\";\n  context.clearRect(0, 0, width, height);\n  context.beginPath();\n\n  const columns = Math.ceil(width / distance);\n  const rows = Math.ceil(height / distance);\n  const matrix = createMatrix(particles, distance);\n\n  const distanceSquare = distance * distance;\n  const halfSize = size / 2;\n\n  for (let row = 0; row < rows; row++) {\n    for (let column = 0; column < columns; column++) {\n      const block: Particle[] = getBlock(matrix, row, column);\n      const neighbours = [].concat(\n        block,\n        getBlock(matrix, row + 1, column),\n        getBlock(matrix, row, column + 1),\n        getBlock(matrix, row + 1, column + 1)\n      );\n\n      block.forEach((particle) => {\n        neighbours.forEach((neighbour) => {\n          if (particle !== neighbour) {\n            const dx = particle.x - neighbour.x;\n            const dy = particle.y - neighbour.y;\n\n            if (dx * dx + dy * dy < distanceSquare) {\n              context.moveTo(particle.x, particle.y);\n              context.lineTo(neighbour.x, neighbour.y);\n            }\n          }\n        });\n\n        context.fillRect(\n          particle.x - halfSize,\n          particle.y - halfSize,\n          size,\n          size\n        );\n      });\n    }\n  }\n\n\n\n  context.stroke();\n}\n","const math = Math;\n\nexport const win = window;\nexport const reqAnimationFrame = window.requestAnimationFrame;\nexport const EVENT_NAME_RESIZE = \"resize\";\nexport const random = math.random;\nexport const ceil = math.ceil;\nexport const floor = math.floor;\n","import { createParticles, moveParticles } from \"./particles\";\nimport { draw, resizer } from \"./canvas\";\nimport { win, reqAnimationFrame, EVENT_NAME_RESIZE } from \"./contants\";\n\ntype Config = {\n  count: number;\n  distance: number;\n  speed: number;\n  animate;\n  boolean;\n  strokeStyle: string;\n  fillStyle: string;\n  size: number;\n};\n\nexport function init(canvas: HTMLCanvasElement, config: Config) {\n  var {\n    count,\n    distance,\n    speed,\n    animate = true,\n    strokeStyle,\n    fillStyle,\n    size = 2,\n  } = config;\n  const onResize = resizer(canvas);\n  const { width, height } = onResize();\n  const particles = createParticles(\n    {\n      x1: 0,\n      y1: 0,\n      x2: width,\n      y2: height,\n    },\n    count,\n    speed\n  );\n\n  win.addEventListener(EVENT_NAME_RESIZE, onResize);\n\n  function redraw() {\n    particles.sort(function (a, b) {\n      return a.r - b.r;\n    });\n\n    //console.time(\"draw\")\n    draw(canvas, particles, { distance, strokeStyle, fillStyle, size });\n    //console.timeEnd(\"draw\")\n\n    if (animate !== false) {\n      moveParticles(particles, width, height);\n      reqAnimationFrame(redraw);\n    }\n  }\n  reqAnimationFrame(redraw);\n\n  return () => {\n    animate = false;\n    win.removeEventListener(EVENT_NAME_RESIZE, onResize);\n  };\n}\n"],"names":["createParticle","param","speed","x1","y1","x2","y2","vx","randomVelocity","vy","x","ceil","random","y","r","Math","sqrt","createParticles","count","array","Array","i","moveParticles","particles","width","height","length","particle","pX","pY","createMatrix","distance","matrix","forEach","row","floor","col","push","draw","canvas","strokeStyle","fillStyle","size","context","getContext","clearRect","beginPath","columns","rows","distanceSquare","halfSize","column","block","getBlock","neighbours","concat","neighbour","dx","dy","moveTo","lineTo","fillRect","stroke","math","win","window","reqAnimationFrame","requestAnimationFrame","EVENT_NAME_RESIZE","ensureArray","subject","isArray","config","animate","onResize","offsetWidth","offsetHeight","redraw","sort","a","b","addEventListener","removeEventListener"],"mappings":"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"}